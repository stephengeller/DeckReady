#!/usr/bin/env bash
# Exec the TypeScript entrypoint using the ts-node CLI
SCRIPT_DIR="$(cd -- "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
# Resolve ts-node from local node_modules if not provided
ROOT_DIR="$(cd -- "$SCRIPT_DIR/.." >/dev/null 2>&1 && pwd)"
TS_NODE="${TS_NODE:-$ROOT_DIR/node_modules/.bin/ts-node}"
# Ensure asdf picks up project .tool-versions by running from ROOT_DIR
cd "$ROOT_DIR"
if [[ ! -x "$TS_NODE" ]]; then
  if command -v ts-node >/dev/null 2>&1; then
    TS_NODE="$(command -v ts-node)"
  else
    printf 'Error: ts-node not found. Please run "yarn install" from %s.\n' "$ROOT_DIR" >&2
    exit 127
  fi
fi
exec env TS_NODE_TRANSPILE_ONLY=1 "$TS_NODE" "$ROOT_DIR/src/cli/runLucky.ts" "$@"
